/* @license Open source under the MIT License.
 * Version: 0.0.1
 * http://niczero.github.com/ng2-es5-file-upload/
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:a.ng2Es5FileUpload={})}(this,function(a){a.FileLikeObject=ng.core.Class({constructor:function(a){var b=!(!a||!(a.nodeName||a.prop&&a.attr&&a.find)),c=b?a.value:a;"string"==typeof c?this._createFromFakePath(c):this._createFromObject(c)},_createFromFakePath:function(a){this.lastModifiedDate=null,this.size=null,this.type="like/"+a.slice(a.lastIndexOf(".")+1).toLowerCase(),this.name=a.slice(a.lastIndexOf("/")+a.lastIndexOf("\\")+2)},_createFromObject:function(a){this.size=a.size,this.type=a.type,this.name=a.name}}),
//require('./fileLikeObject.js');
a.FileItem=ng.core.Class({constructor:function(b,c,d){this.uploader=b,this.some=c,this.options=d,this.alias="file",this.url="/",this.method="POST",this.headers=[],this.withCredentials=!0,this.formData=[],this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.index=null,this.file=new a.FileLikeObject(c),this._file=c,this.url=b.url},upload:function(){try{this.uploader.uploadItem(this)}catch(a){this.uploader._onCompleteItem(this,"",0,[]),this.uploader._onErrorItem(this,"",0,[])}},cancel:function(){this.uploader.cancelItem(this)},remove:function(){this.uploader.removeFromQueue(this)},onBeforeUpload:function(){},onProgress:function(a){},onSuccess:function(a,b,c){},onError:function(a,b,c){},onCancel:function(a,b,c){},onComplete:function(a,b,c){},_onBeforeUpload:function(){this.isReady=!0,this.isUploading=!0,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!1,this.isError=!1,this.progress=0,this.onBeforeUpload()},_onProgress:function(a){this.progress=a,this.onProgress(a)},_onSuccess:function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!0,this.isCancel=!1,this.isError=!1,this.progress=100,this.index=null,this.onSuccess(a,b,c)},_onError:function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!0,this.isSuccess=!1,this.isCancel=!1,this.isError=!0,this.progress=0,this.index=null,this.onError(a,b,c)},_onCancel:function(a,b,c){this.isReady=!1,this.isUploading=!1,this.isUploaded=!1,this.isSuccess=!1,this.isCancel=!0,this.isError=!1,this.progress=0,this.index=null,this.onCancel(a,b,c)},_onComplete:function(a,b,c){this.onComplete(a,b,c),this.uploader.removeAfterUpload&&this.remove()},_prepareToUploading:function(){this.index=this.index||++this.uploader._nextIndex,this.isReady=!0}}),
//require('./fileLikeObject.js');
//require('./fileItem.js');
a.FileUploader=ng.core.Directive({selector:"uploader"}).Class({constructor:function(a){this.options=a,this.isUploading=!1,this.queue=[],this.progress=0,this.autoUpload=!1,this.isHTML5=!0,this.removeAfterUpload=!1,this._nextIndex=0,this.filters=[],this.url=a.url,this.authToken=a.authToken,this.filters.unshift({name:"queueLimit",fn:this._queueLimitFilter}),this.filters.unshift({name:"folder",fn:this._folderFilter})},addToQueue:function(b,c,d){for(var e=this,f=[],g=0;g<b.length;g++){var h=b[g];f.push(h)}var i=this._getFilters(d),j=this.queue.length,k=[];f.map(function(b){var d=new a.FileLikeObject(b);if(e._isValidFile(d,[],c)){var f=new a.FileItem(e,b,c);k.push(f),e.queue.push(f),e._onAfterAddingFile(f)}else{var g=i[e._failFilterIndex];e._onWhenAddingFileFailed(d,g,c)}}),this.queue.length!==j&&(this._onAfterAddingAll(k),this.progress=this._getTotalProgress()),this._render(),this.autoUpload&&this.uploadAll()},removeFromQueue:function(a){var b=this.getIndexOfItem(a),c=this.queue[b];c.isUploading&&c.cancel(),this.queue.splice(b,1),this.progress=this.queue.length>0?this._getTotalProgress():0},clearQueue:function(){for(;this.queue.length;)this.queue[0].remove();this.progress=0},uploadItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhrTransport":"_iframeTransport";c._prepareToUploading(),this.isUploading||(this.isUploading=!0,this[d](c))},cancelItem:function(a){var b=this.getIndexOfItem(a),c=this.queue[b],d=this.isHTML5?"_xhr":"_form";c&&c.isUploading&&c[d].abort()},uploadAll:function(){var a=this.getNotUploadedItems().filter(function(a){return!a.isUploading});a.length&&(a.map(function(a){return a._prepareToUploading()}),a[0].upload())},cancelAll:function(){var a=this.getNotUploadedItems();a.map(function(a){return a.cancel()})},isFile:function(a){return File&&a instanceof File},isFileLikeObject:function(b){return b instanceof a.FileLikeObject},getIndexOfItem:function(a){return"number"==typeof a?a:this.queue.indexOf(a)},getNotUploadedItems:function(){return this.queue.filter(function(a){return!a.isUploaded})},getReadyItems:function(){return this.queue.filter(function(a){return a.isReady&&!a.isUploading}).sort(function(a,b){return a.index-b.index})},destroy:function(){},onAfterAddingAll:function(a){},onAfterAddingFile:function(a){},onWhenAddingFileFailed:function(a,b,c){},onBeforeUploadItem:function(a){},onProgressItem:function(a,b){},onProgressAll:function(a){},onSuccessItem:function(a,b,c,d){},onErrorItem:function(a,b,c,d){},onCancelItem:function(a,b,c,d){},onCompleteItem:function(a,b,c,d){},onCompleteAll:function(){},_getTotalProgress:function(a){if(void 0===a&&(a=0),this.removeAfterUpload)return a;var b=this.getNotUploadedItems().length,c=b?this.queue.length-b:this.queue.length,d=100/this.queue.length,e=a*d/100;return Math.round(c*d+e)},_getFilters:function(a){if(!a)return this.filters;if(Array.isArray(a))return a;var b=a.match(/[^\s,]+/g);return this.filters.filter(function(a){return-1!==b.indexOf(a.name)})},_render:function(){},_folderFilter:function(a){return!(!a.size&&!a.type)},_queueLimitFilter:function(){return this.queue.length<this.queueLimit},_isValidFile:function(a,b,c){var d=this;return this._failFilterIndex=-1,b.length?b.every(function(b){return d._failFilterIndex++,b.fn.call(d,a,c)}):!0},_isSuccessCode:function(a){return a>=200&&300>a||304===a},_transformResponse:function(a,b){return a},_parseHeaders:function(a){var b,c,d,e={};return a?(a.split("\n").map(function(a){d=a.indexOf(":"),b=a.slice(0,d).trim().toLowerCase(),c=a.slice(d+1).trim(),b&&(e[b]=e[b]?e[b]+", "+c:c)}),e):e},_headersGetter:function(a){return function(b){return b?a[b.toLowerCase()]||null:a}},_xhrTransport:function(a){var b=this,c=a._xhr=new XMLHttpRequest,d=new FormData;if(this._onBeforeUploadItem(a),"number"!=typeof a._file.size)throw new TypeError("The file specified is no longer valid");d.append(a.alias,a._file,a.file.name),c.upload.onprogress=function(c){var d=Math.round(c.lengthComputable?100*c.loaded/c.total:0);b._onProgressItem(a,d)},c.onload=function(){var d=b._parseHeaders(c.getAllResponseHeaders()),e=b._transformResponse(c.response,d),f=b._isSuccessCode(c.status)?"Success":"Error",g="_on"+f+"Item";b[g](a,e,c.status,d),b._onCompleteItem(a,e,c.status,d)},c.onerror=function(){var d=b._parseHeaders(c.getAllResponseHeaders()),e=b._transformResponse(c.response,d);b._onErrorItem(a,e,c.status,d),b._onCompleteItem(a,e,c.status,d)},c.onabort=function(){var d=b._parseHeaders(c.getAllResponseHeaders()),e=b._transformResponse(c.response,d);b._onCancelItem(a,e,c.status,d),b._onCompleteItem(a,e,c.status,d)},c.open(a.method,a.url,!0),c.withCredentials=a.withCredentials,this.authToken&&c.setRequestHeader("Authorization",this.authToken),c.send(d),this._render()},_iframeTransport:function(a){},_onWhenAddingFileFailed:function(a,b,c){this.onWhenAddingFileFailed(a,b,c)},_onAfterAddingFile:function(a){this.onAfterAddingFile(a)},_onAfterAddingAll:function(a){this.onAfterAddingAll(a)},_onBeforeUploadItem:function(a){a._onBeforeUpload(),this.onBeforeUploadItem(a)},_onProgressItem:function(a,b){var c=this._getTotalProgress(b);this.progress=c,a._onProgress(b),this.onProgressItem(a,b),this.onProgressAll(c),this._render()},_onSuccessItem:function(a,b,c,d){a._onSuccess(b,c,d),this.onSuccessItem(a,b,c,d)},_onErrorItem:function(a,b,c,d){a._onError(b,c,d),this.onErrorItem(a,b,c,d)},_onCancelItem:function(a,b,c,d){a._onCancel(b,c,d),this.onCancelItem(a,b,c,d)},_onCompleteItem:function(a,b,c,d){a._onComplete(b,c,d),this.onCompleteItem(a,b,c,d);var e=this.getReadyItems()[0];return this.isUploading=!1,e?void e.upload():(this.onCompleteAll(),this.progress=this._getTotalProgress(),void this._render())}}),a.FileSelect=ng.core.Directive({selector:"[ng2-file-select]",properties:["uploader"],host:{"(change)":"onChange()"}}).Class({constructor:[ng.core.ElementRef,function(a){this.element=a}],getOptions:function(){return this.uploader.options},getFilters:function(){},isEmptyAfterSelection:function(){return!this.element.nativeElement.attributes.multiple},onChange:function(){var a=this.element.nativeElement.files,b=this.getOptions(),c=this.getFilters();this.uploader.addToQueue(a,b,c),this.isEmptyAfterSelection()}}),a.FileDrop=ng.core.Directive({selector:"[ng2-file-drop]",properties:["uploader"],events:["fileOver"],host:{"(drop)":"onDrop($event)","(dragover)":"onDragOver($event)","(dragleave)":"onDragLeave($event)"}}).Class({constructor:[ng.core.ElementRef,function(a){this.element=a,this.fileOver=new ng.core.EventEmitter}],getOptions:function(){return this.uploader.options},getFilters:function(){},onDrop:function(a){var b=this._getTransfer(a);if(b){var c=this.getOptions(),d=this.getFilters();this._preventAndStop(a),this.uploader.addToQueue(b.files,c,d),this.fileOver.next(!1)}},onDragOver:function(a){var b=this._getTransfer(a);this._haveFiles(b.types)&&(b.dropEffect="copy",this._preventAndStop(a),this.fileOver.next(!0))},onDragLeave:function(a){a.currentTarget!==this.element[0]&&(this._preventAndStop(a),this.fileOver.next(!1))},_getTransfer:function(a){return a.dataTransfer?a.dataTransfer:a.originalEvent.dataTransfer},_preventAndStop:function(a){a.preventDefault(),a.stopPropagation()},_haveFiles:function(a){return a?a.indexOf?-1!==a.indexOf("Files"):a.contains?a.contains("Files"):!1:!1},_addOverClass:function(a){a.addOverClass()},_removeOverClass:function(a){a.removeOverClass()}})});
//# sourceMappingURL=ng2-es5-file-upload.umd.min.js.map